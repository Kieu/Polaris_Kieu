<% if flash[:success] %>
  <div><%= flash[:success] %></div>
<% end %>
<%= link_to 'New User', "javascript:void(0)", class: "new_agency",onclick: "ajaxCommon('#{new_user_path}', '', '', '','#inner')" %>
<table id="flex1" style="display:none"></table>
<script type="text/javascript">
	$("#flex1").flexigrid({
		url: "<%= get_users_list_users_path %>",
		dataType: 'json',
		colModel : [
    {display: '', name : 'link', width : 20, sortable : false, align: 'center'},
    {display: 'Romanji Name', name : 'roman_name', width : 200, sortable : false, align: 'center'},
	  {display: 'User Name', name : 'username', width : 200, sortable : false, align: 'center'},
    {display: 'email', name : 'email', width : 200, sortable : false, align: 'left'},
    {display: 'Company', name : 'company', width : 200, sortable : false, align: 'left'},
    {display: 'Role', name : 'role_id', width : 100, sortable : false, align: 'left'}
			],
			preProcess : function (json) {
            
            var results = new Array();
            jQuery.each(json.object, function() {
                
                var row = {};
                var cell = new Array();
                
                jQuery.each(this, function(k, v) {

                    if (k == "state" && v == "") {
                        cell.push("NA");
                    } else {
                    	cell[k] = v;
                        cell.push(this);
                    }
                });

                row["cell"] = cell;
                results.push(row);
            });
            
            return {
                rows : results,
                page : json.pageCount,
                total : json.total
            };
        }
		usepager: true,
		title: 'Users',
		useRp: true,
		rp: 10,
		showTableToggleBtn: true,
		width: 720,
		height: 300
	});
</script>
