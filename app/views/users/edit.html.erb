<%= render "layouts/prevent_change_page" %>
<%= stylesheet_link_tag "css/common" %>
<%= flash[:success] if flash[:success] %>
<div id="user_form">
  <p class="h2"><%= I18n.t("user.crumb_edit") %></p>
  <%= form_for(@user) do |f| %>
      <table>
        <tbody>
        <tr>
          <th><%= f.label I18n.t("user.username") %></th>
          <td colspan="2"><%= f.text_field :username, maxlength: 255, style: "width: 200px" %></td>
        </tr>
        <tr>
          <th><%= f.label I18n.t("user.roman_name") %></th>
          <td colspan="2"><%= f.text_field :roman_name, maxlength: 255, style: "width: 200px" %></td>
        </tr>
        <tr>
          <th> <%= f.label I18n.t("user.email") %></th>
          <td colspan="2"><%= f.text_field :email, maxlength: 255, style: "width: 200px" %></td>
        </tr>
        <tr>
          <th> <%= f.label I18n.t("user.role.label") %></th>
          <td colspan="2">
            <%= text_field_tag :role_id, @user.role.role_name, disabled: true %>
          </td>
        </tr>
        <tr>
          <th><%= f.label I18n.t("user.company_name") %></th>
          <td colspan="2">
            <% if @user.client? %>
                <%= text_field_tag :company_id, Client.find(@user.company_id).client_name, disabled: true %>
            <% else %>
                <%= text_field_tag :company_id, Agency.find(@user.company_id).agency_name, disabled: true %>
            <% end %>
        </tr>
        <tr>
          <th> <%= f.label I18n.t("user.password.label") %></th>
          <td colspan="2">*******************</td>
        </tr>
        <tr>
          <th><%= f.label I18n.t("user.password_notification.label") %></th>
          <td><%= f.radio_button :password_flg, "0", disabled: true %> <%= f.label I18n.t("user.password_notification.not_notified") %></td>
          <td><%= f.radio_button :password_flg, "1", disabled: true %> <%= f.label I18n.t("user.password_notification.to_notified") %></td>
        </tr>
        <tr>
          <th><%= f.label I18n.t("user.disabled.label") %></th>
          <td>
              <% if @user.status == Settings.user.deactive %>
                  <input type="checkbox" id = "disable_button" checked="checked">
              <% else %>
                  <input type="checkbox" id = "disable_button">
              <% end %><%= I18n.t("user.disabled.disable") %>
          </td>
        </tr>
        </tbody>
      </table>
      <div class="submit_area">
        <input type="image" id="btn_submit" src="/assets/btn_done.gif">
        <%= link_to raw('<img align="right" alt="キャンセル" src="/assets/btn_cancel.gif">'), users_path %>
      </div>
      </form>
  <% end %>
</div>

<div style='display:none'>
	<div id="disabled" style='padding:10px; background:#fff;'>
		<div>User can not login again</div>
		<div>Username: <%= @user.username %></div>
		<div>Email: <%= @user.email %></div>
		<div>Role: <%= @user.role.role_name %></div>
		<button class="ok_popup">Ok</button>
		<button class="cancel_popup">Cancel</button>
	</div>
	<div id="enabled" style='padding:10px; background:#fff;'>
		<div>User can login again</div>
		<div>Username: <%= @user.username %></div>
		<div>Email: <%= @user.email %></div>
		<div>Role: <%= @user.role.role_name %></div>
		<button class="ok_popup">Ok</button>
		<button class="cancel_popup">Cancel</button>
	</div>
</div>
<script type="text/javascript">
	$(function(){
		$("#cancel").click(function(e){
			e.preventDefault();
			$.colorbox({
				width: "30%",
				inline: true,
				escKey: false,
				overlayClose: false,
				href: "#prevent_change",
			})
		})
		check = $("#disable_button").is(':checked')? true : false;
		$("#disable_button").click(function(e){
			if (check){
				enable = $.colorbox({
					width: "30%",
					inline: true,
					escKey: false,
					href: "#enabled",
					overlayClose: false,
					onClosed: function(){
						$("#disable_button").attr("checked",check);
					}
				});
			}else{
				disable = $.colorbox({
					width: "30%",
					inline: true,
					escKey: false,
					href: "#disabled",
					overlayClose: false,
					onClosed: function(){
						$("#disable_button").attr("checked",check);
					}
				});
			}
		})
		$(".cancel_popup").click(function(){
			$("#enabled").colorbox.close();
			$("#disabled").colorbox.close();
		})
		$(".ok_popup").click(function(){
			$.ajax({
				type: "POST",
				url: "<%= enable_disable_user_users_path %>",
				data: "id=<%= @user.id%>",
				success: function(data){
					location.href = "<%= users_path %>";
				}
			});
		})
	})
</script>
