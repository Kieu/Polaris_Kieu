<table width="100%" border="1" bordercolor="#b5b5b5" cellpadding="0" class="promotion_table" id="promotion_table">
<tr>
	<td rowspan="3" class="table_header">Media</td>
	<td rowspan="3" class="table_header">Account</td>
	<% Settings.promotions_options.each_with_index do |option, index|%>
		<%= content_tag(:td, option, rowspan: "3", class: "table_header") if cookies[:promotion][index] == "1" %>
	<% end %>
	<% @conversions.each do |conversion|%>
		<% colspan = cal_col_cv(conversion.id) %>
		<%= content_tag(:td, conversion.conversion_name, colspan: colspan, class: "table_header") if colspan > 0 %>
	<% end %>
</tr>
<tr>
	<% @conversions.each_with_index do |conversion, index|%>
		<% colspan = cal_cv(conversion.id) %>
		<%= content_tag(:td, "CV#{index}", colspan: colspan, class: "table_header") if colspan > 0 %>
		<% Settings.conversions_options.each_with_index do |option, index1|%>
			<% break if index1 == 7 %>
			<%= content_tag(:td, Settings.conversions_options[index1+3], rowspan: "2", class: "table_header") if colspan > 0 && cookies[("conversion" + conversion.id.to_s).to_sym][index1+3] == "1"%>
		<% end %>
	<% end %>
</tr>
<tr>
	<% @conversions.each do |conversion|%>
		<% colspan = cal_cv(conversion.id) %>
		<% Settings.conversions_options.each_with_index do |option, index1|%>
			<% break if index1 == 3 %>
			<%= content_tag(:td, Settings.conversions_options[index1], class: "table_header") if colspan > 0 && cookies[("conversion" + conversion.id.to_s).to_sym][index1] == "1"%>
		<% end %>
	<% end %>
</tr>
<tr>
	<td class="header_total"></td>
	<td class="header_total"></td>
	<% Settings.promotions_sums.each_with_index do |option, index|%>
		<%= content_tag(:td, @promotion_results["total"][option], class: "header_total") if cookies[:promotion][index] == "1" %>
	<% end %>
	<% @conversions.each do |conversion|%>
		<% Settings.conversions_sums.each_with_index do |option, index|%>
			<%= content_tag(:td, @conversions_results["total_conversion"+conversion.id.to_s][option], class: "header_total") if cookies[("conversion" + conversion.id.to_s).to_sym][index] == "1"%>
		<% end %>
	<% end %>
</tr>
<% Settings.media_category.each do |category| %>
	<tr>
    	<td class="category_header"><%= category[1] %></td>
		<td class="category_header">total</td>
		<% Settings.promotions_sums.each_with_index do |option, index|%>
			<% val = @promotion_results[category[1]+"_total"] %>
			<%= content_tag(:td, val.nil? ? "0" : val[option], class: "category_header") if cookies[:promotion][index] == "1" %>
		<% end %>
		<% @conversions.each do |conversion|%>
			<% Settings.conversions_sums.each_with_index do |option, index|%>
				<%= content_tag(:td, "total", class: "category_header") if cookies[("conversion" + conversion.id.to_s).to_sym][index] == "1"%>
			<% end %>
		<% end %>
	</tr>
    <% @media_list[category[1].to_s+"_media"].each_with_index do |media, index| %>
		<% break if index == "10" %>
		<% @account_list["media"+media.id.to_s+"_account"].each_with_index do |account, index1| %>
		<tr>
			<%= content_tag(:td, media.media_name, rowspan: @account_list["media"+media.id.to_s+"_account"].count) if index1 == 0 %>
            <td><%= account.account_name %></td>
            <% Settings.promotions_sums.each_with_index do |option, index2|%>
				<%= content_tag(:td, @promotion_results["account"+account.id.to_s+"_promotion"][option]) if cookies[:promotion][index2] == "1" %>
			<% end %>
			<% @conversions.each do |conversion|%>
				<% Settings.conversions_sums.each_with_index do |option, index2|%>
					<%= content_tag(:td, @conversions_results["account"+account.id.to_s+"_conversion"+conversion.id.to_s][option]) if cookies[("conversion" + conversion.id.to_s).to_sym][index2] == "1"%>
				<% end %>
			<% end %>
        </tr>
        <% end %>
    <% end %>
<% end %>
</table>