<!DOCTYPE html>
<html>
<head>
  <title>PolarisManage</title>
  <%= stylesheet_link_tag "application", :media => "all" %>
  <%= stylesheet_link_tag "css/#{params[:controller]}" %>
  <%= javascript_include_tag "application" %>

  <%= csrf_meta_tags %>
</head>
<body>
<div style="display:none" id="dvloader"><img src="/assets/ajax-loader.gif" /></div>
<div id="wrapper">
  <%= render "layouts/header" %>
  <div id="container">
    <div id="contents">
      <% if signed_in? %>
          <div id="inner">
            <%= yield %>
          </div>
      <% else %>
          <%= yield %>
      <% end %>
    </div>
  </div>
  <% if signed_in? && (@clients || @array_promotion) %>
      <div id="sidebar">
        <div id="clienetlist_box">
          <dl>
            <dt></dt>
            <dd>
              <form action="#" method="get" id="searchform" name="searchform">
                <input type="text" placeholder="検索" id="keywords" name="keywords" maxlength="255">
                <input type="image" id="searchBtn" name="searchBtn" alt="検索" src="/assets/img_loupe.gif">
              </form>
            </dd>
          </dl>
          <div style="border-top:1px solid #c1c1c1;"></div>
          <div id="clients_list">
            <% if @clients %>
                <table class="sidebar">
                  <% if current_user.super? %>
                      <% @clients.each_with_index do |client, index| %>
                          <% if (params[:id] && client.id == params[:id].to_i) || (!params[:id] && index == 0) %>
                              <tr>
                                <th class="edit"><%= link_to "", "javascript:void(0)", class: "edit", id: "edit#{client.id}",onclick: "ajaxCommon('#{edit_client_path(client)}##{index}}', '##{client.id}', '.client_name', '#client_name','#inner')" %></th>
                                <td><%= link_to client.client_name, "javascript:void(0)", class: "client_name active", id: "#{client.id}", onclick: "reloadFlex('.flexme4', '#{get_promotions_list_clients_path}?id=#{client.id}', '##{client.id}', '.client_name', '#client_name', #{Settings.MAX_LENGTH_NAME})" %></td>
                              </tr>
                          <% else %>
                              <tr>
                                <th class="edit"><%= link_to "", "javascript:void(0)", class: "edit", id: "edit#{client.id}",onclick: "ajaxCommon('#{edit_client_path(client)}##{client.id}}', '##{client.id}', '.client_name', '#client_name','#inner')" %></th>
                                <td><%= link_to client.client_name, "javascript:void(0)", class: "client_name", id: "#{client.id}", onclick: "reloadFlex('.flexme4', '#{get_promotions_list_clients_path}?id=#{client.id}', '##{client.id}', '.client_name', '#client_name', #{Settings.MAX_LENGTH_NAME})" %></td>
                              </tr>
                          <% end %>
                      <% end %>
                  <% else %>
                      <% @clients.each_with_index do |client, index| %>
                          <% if (params[:id] && client.id == params[:id].to_i) || (!params[:id] && index == 0) %>
                              <tr>
                                <th class="edit"></th>
                                <td><%= link_to client.client_name, "javascript:void(0)", class: "client_name active", id: "#{client.id}", onclick: "reloadFlex('.flexme4', '#{get_promotions_list_clients_path}?id=#{client.id}', '##{client.id}', '.client_name', '#client_name', #{Settings.MAX_LENGTH_NAME})" %></td>
                              </tr>
                          <% else %>
                              <tr>
                                <th class="edit"></th>
                                <td><%= link_to client.client_name, "javascript:void(0)", class: "client_name", id: "#{client.id}", onclick: "reloadFlex('.flexme4', '#{get_promotions_list_clients_path}?id=#{client.id}', '##{client.id}', '.client_name', '#client_name', #{Settings.MAX_LENGTH_NAME})" %></td>
                              </tr>
                          <% end %>
                      <% end %>
                  <% end %>
                </table>
            <% elsif @array_promotion %>
                <div id="promotions_list">
                  <table class="sidebar">
                    <% if current_user.super? || current_user.agency? %>
                        <% @array_promotion.each_with_index do |promotion, index| %>
                            <% if (promotion.id == @promotion_id.to_i) %>
                                <tr>
                                  <th class="edit"><%= link_to "", "javascript:void(0)", class: "edit", id: "edit#{index}",onclick: "ajaxCommon('#{edit_promotion_path(promotion)}##{index}', '##{index}', '.promotion_name', '#promotion_name','#inner')" %></th>
                                  <td><%= link_to promotion.promotion_name, "javascript:void(0)", class: "promotion_name active", id: "#{index}",onclick: "ajaxCommon('#{promotions_path(promotion_id: promotion.id, client_id: @client_id)}', '##{index}', '.promotion_name', '#promotion_name','#inner')" %></td>
                                </tr>
                            <% else %>
                                <tr>
                                  <th class="edit"><%= link_to "","javascript:void(0)", class: "edit", id: "edit#{index}",onclick: "ajaxCommon('#{edit_promotion_path(promotion)}##{index}', '##{index}', '.promotion_name', '#promotion_name','#inner')" %></th>
                                  <td><%= link_to promotion.promotion_name,  "javascript:void(0)", class: "promotion_name", id: "#{index}",onclick: "ajaxCommon('#{promotions_path(promotion_id: promotion.id, client_id: @client_id)}', '##{index}', '.promotion_name', '#promotion_name','#inner')" %></td>
                                </tr>
                            <% end %>
                        <% end %>
                    <% else %>
                        <% @array_promotion.each_with_index do |promotion, index| %>
                            <% if (promotion.id == @promotion_id.to_i) %>
                                <tr>
                                  <th class="edit"></th>
                                  <td><%= link_to "#{edit_promotion_path(promotion)}##{index}", promotions_path(promotion_id: promotion.id, client_id: @client_id), class: "promotion_name active", id: index %></td>
                                </tr>
                            <% else %>
                                <tr>
                                  <th class="edit"></th>
                                  <td><%= link_to "#{edit_promotion_path(promotion)}##{index}", promotions_path(promotion_id: promotion.id, client_id: @client_id), class: "promotion_name", id: index %></td>
                                </tr>
                            <% end %>
                        <% end %>
                    <% end %>
                  </table>
                </div>
            <% end %>
          </div>
        </div>
        <% if @clients %>
            <%= link_to raw('<img src="/assets/btn_client_regist.gif">'), "javascript:void(0)", class: "new_client_name", onclick: "ajaxCommon('#{new_client_path}', '', '.new_client_name', '#new_client_name','#inner')"  %>
        <% elsif current_user.super? || current_user.agency? %>
            <%= link_to raw('<img src="/assets/btn_client_regist.gif">'), "javascript:void(0)", class: "new_promotion_name", onclick: "ajaxCommon('#{new_promotion_path(client_id: @client_id)}', '', '.new_promotion_name', '#new_promotion_name','#inner')"  %>
        <% end %>
      </div>
  <% else %>
      <% if !signed_in? %><%= render "layouts/login" %>
      <% end %>
  <% end %>


  <script type="text/javascript">
      $('input#keywords').quicksearch('div#clients_list tr', {
          "selector": "a.client_name"
      });
      $('input#keywords').quicksearch('div#promotions_list tr', {
          "selector": "a.promotion_name"
      });
  </script>
  <%= render "layouts/footer" %>
</div>
</body>
</html>
